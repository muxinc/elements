var V=e=>{throw TypeError(e)};var T=(e,n,t)=>n.has(e)||V("Cannot "+t);var r=(e,n,t)=>(T(e,n,"read from private field"),t?t.call(e):n.get(e)),c=(e,n,t)=>n.has(e)?V("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(e):n.set(e,t),l=(e,n,t,u)=>(T(e,n,"write to private field"),u?u.call(e,t):n.set(e,t),t),d=(e,n,t)=>(T(e,n,"access private method"),t);var h=class{addEventListener(){}removeEventListener(){}dispatchEvent(n){return!0}};if(typeof DocumentFragment=="undefined"){class e extends h{}globalThis.DocumentFragment=e}var b=class extends h{},p=class extends h{},G={get(e){},define(e,n,t){},getName(e){return null},upgrade(e){},whenDefined(e){return Promise.resolve(b)}},g,C=class{constructor(n,t={}){c(this,g);l(this,g,t==null?void 0:t.detail)}get detail(){return r(this,g)}initCustomEvent(){}};g=new WeakMap;function K(e,n){return new b}var y={document:{createElement:K},DocumentFragment,customElements:G,CustomEvent:C,EventTarget:h,HTMLElement:b,HTMLVideoElement:p},D=typeof window=="undefined"||typeof globalThis.customElements=="undefined",v=D?y:globalThis,J=D?y.document:globalThis.document;var B=(e,n,t,u)=>{let f=`https://stats.mux.com/counts?token=${e}`,N=new AbortController,U=N.signal,E,P=!1,I=()=>P?Promise.resolve():fetch(f,{signal:U}).then(s=>s.json()).then(s=>{var R,k,x;let L=(k=(R=s==null?void 0:s.data)==null?void 0:R[0])==null?void 0:k.views;return s!=null&&s.error||L==null?Promise.reject((x=s==null?void 0:s.error)!=null?x:"no data in response"):(t(L),L)}).catch(u).then(()=>new Promise(s=>{E=setTimeout(()=>{s(void 0)},n*1e3)})).then(I);return I(),()=>{P=!0,N.abort(),typeof E=="number"&&(clearTimeout(E),E=void 0)}},i={TOKEN:"token",POLL_INTERVAL:"poll-interval",DISABLED:"disabled"},H=20,q=Object.freeze(Object.values(i)),z="Viewer Count",M="??",S=({viewerCount:e})=>{let n=typeof e=="number"?`${e}`:"Unknown";return`${z} ${n}`},F=document.createElement("template");F.innerHTML=`
<span id="viewer-count">
${M}
</span>
`;var a,o,$,m,_,w,A=class extends v.HTMLElement{constructor(){super();c(this,o);c(this,a);c(this,m);this.attachShadow({mode:"open"}).appendChild(F.content.cloneNode(!0))}static get observedAttributes(){return q}get views(){var t;return(t=r(this,m))!=null?t:Number.NaN}get token(){var t;return(t=this.getAttribute(i.TOKEN))!=null?t:""}set token(t){this.token!==t&&(l(this,m,void 0),this.setAttribute(i.TOKEN,t))}get pollInterval(){let t=this.hasAttribute(i.POLL_INTERVAL)?+this.getAttribute(i.POLL_INTERVAL):H;return t<15&&(console.warn("Poll interval must be at least 15 seconds, setting to 15."),t=15),t}set pollInterval(t){this.pollInterval!==t&&this.setAttribute(i.POLL_INTERVAL,`${t}`)}enable(){this.setAttribute("tabindex","0")}disable(){this.removeAttribute("tabindex")}connectedCallback(){this.hasAttribute("disabled")||this.enable(),this.setAttribute("aria-label",S({})),this.setAttribute("role","presentation"),d(this,o,_).call(this)}disconnectedCallback(){d(this,o,w).call(this)}attributeChangedCallback(t,u,f){t===i.POLL_INTERVAL||t===i.TOKEN?(d(this,o,w).call(this),d(this,o,_).call(this)):t===i.DISABLED&&u!==f&&(f?this.disable():this.enable())}};a=new WeakMap,o=new WeakSet,$=function(){return this.shadowRoot.querySelector("#viewer-count")},m=new WeakMap,_=function(){this.token&&this.pollInterval&&!r(this,a)&&l(this,a,B(this.token,this.pollInterval,t=>{l(this,m,t),this.dispatchEvent(new CustomEvent("change",{detail:t})),r(this,o,$).textContent=`${this.views}`,this.setAttribute("aria-label",S({viewerCount:t}))},t=>{this.dispatchEvent(new CustomEvent("error",{detail:t})),console.warn("Failed to retrieve viewer count: Error - ",t),d(this,o,w).call(this)}))},w=function(){var t;(t=r(this,a))==null||t.call(this),l(this,a,void 0)};v.customElements.get("mux-active-viewer-count")||v.customElements.define("mux-active-viewer-count",A);var Y=A;export{Y as default,B as subscribeViewerCount};
//# sourceMappingURL=mux-active-viewer-counts.mjs.map
