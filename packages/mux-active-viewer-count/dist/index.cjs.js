"use strict";var T=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var y=e=>{throw TypeError(e)};var z=(e,n)=>{for(var t in n)T(e,t,{get:n[t],enumerable:!0})},M=(e,n,t,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of H(n))!q.call(e,i)&&i!==t&&T(e,i,{get:()=>n[i],enumerable:!(r=B(n,i))||r.enumerable});return e};var W=e=>M(T({},"__esModule",{value:!0}),e);var p=(e,n,t)=>n.has(e)||y("Cannot "+t);var a=(e,n,t)=>(p(e,n,"read from private field"),t?t.call(e):n.get(e)),d=(e,n,t)=>n.has(e)?y("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(e):n.set(e,t),u=(e,n,t,r)=>(p(e,n,"write to private field"),r?r.call(e,t):n.set(e,t),t),h=(e,n,t)=>(p(e,n,"access private method"),t);var tt={};z(tt,{default:()=>j,subscribeViewerCount:()=>$});module.exports=W(tt);var m=class{addEventListener(){}removeEventListener(){}dispatchEvent(n){return!0}};if(typeof DocumentFragment=="undefined"){class e extends m{}globalThis.DocumentFragment=e}var g=class extends m{},C=class extends m{},J={get(e){},define(e,n,t){},getName(e){return null},upgrade(e){},whenDefined(e){return Promise.resolve(g)}},f,_=class{constructor(n,t={}){d(this,f);u(this,f,t==null?void 0:t.detail)}get detail(){return a(this,f)}initCustomEvent(){}};f=new WeakMap;function O(e,n){return new g}var D={document:{createElement:O},DocumentFragment,customElements:J,CustomEvent:_,EventTarget:m,HTMLElement:g,HTMLVideoElement:C},S=typeof window=="undefined"||typeof globalThis.customElements=="undefined",v=S?D:globalThis,nt=S?D.document:globalThis.document;var $=(e,n,t,r)=>{let i=`https://stats.mux.com/counts?token=${e}`,P=new AbortController,K=P.signal,E,I=!1,R=()=>I?Promise.resolve():fetch(i,{signal:K}).then(s=>s.json()).then(s=>{var k,x,V;let L=(x=(k=s==null?void 0:s.data)==null?void 0:k[0])==null?void 0:x.views;return s!=null&&s.error||L==null?Promise.reject((V=s==null?void 0:s.error)!=null?V:"no data in response"):(t(L),L)}).catch(r).then(()=>new Promise(s=>{E=setTimeout(()=>{s(void 0)},n*1e3)})).then(R);return R(),()=>{I=!0,P.abort(),typeof E=="number"&&(clearTimeout(E),E=void 0)}},l={TOKEN:"token",POLL_INTERVAL:"poll-interval",DISABLED:"disabled"},Q=20,X=Object.freeze(Object.values(l)),Y="Viewer Count",Z="??",F=({viewerCount:e})=>{let n=typeof e=="number"?`${e}`:"Unknown";return`${Y} ${n}`},U=document.createElement("template");U.innerHTML=`
<span id="viewer-count">
${Z}
</span>
`;var c,o,G,b,N,w,A=class extends v.HTMLElement{constructor(){super();d(this,o);d(this,c);d(this,b);this.attachShadow({mode:"open"}).appendChild(U.content.cloneNode(!0))}static get observedAttributes(){return X}get views(){var t;return(t=a(this,b))!=null?t:Number.NaN}get token(){var t;return(t=this.getAttribute(l.TOKEN))!=null?t:""}set token(t){this.token!==t&&(u(this,b,void 0),this.setAttribute(l.TOKEN,t))}get pollInterval(){let t=this.hasAttribute(l.POLL_INTERVAL)?+this.getAttribute(l.POLL_INTERVAL):Q;return t<15&&(console.warn("Poll interval must be at least 15 seconds, setting to 15."),t=15),t}set pollInterval(t){this.pollInterval!==t&&this.setAttribute(l.POLL_INTERVAL,`${t}`)}enable(){this.setAttribute("tabindex","0")}disable(){this.removeAttribute("tabindex")}connectedCallback(){this.hasAttribute("disabled")||this.enable(),this.setAttribute("aria-label",F({})),this.setAttribute("role","presentation"),h(this,o,N).call(this)}disconnectedCallback(){h(this,o,w).call(this)}attributeChangedCallback(t,r,i){t===l.POLL_INTERVAL||t===l.TOKEN?(h(this,o,w).call(this),h(this,o,N).call(this)):t===l.DISABLED&&r!==i&&(i?this.disable():this.enable())}};c=new WeakMap,o=new WeakSet,G=function(){return this.shadowRoot.querySelector("#viewer-count")},b=new WeakMap,N=function(){this.token&&this.pollInterval&&!a(this,c)&&u(this,c,$(this.token,this.pollInterval,t=>{u(this,b,t),this.dispatchEvent(new CustomEvent("change",{detail:t})),a(this,o,G).textContent=`${this.views}`,this.setAttribute("aria-label",F({viewerCount:t}))},t=>{this.dispatchEvent(new CustomEvent("error",{detail:t})),console.warn("Failed to retrieve viewer count: Error - ",t),h(this,o,w).call(this)}))},w=function(){var t;(t=a(this,c))==null||t.call(this),u(this,c,void 0)};v.customElements.get("mux-active-viewer-count")||v.customElements.define("mux-active-viewer-count",A);var j=A;
//# sourceMappingURL=index.cjs.js.map
